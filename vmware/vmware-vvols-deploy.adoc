---
sidebar: sidebar 
permalink: vmware/vmware-vvols-deploy.html 
keywords: tr-4400, vvols, ontap, virtual volumes, deploy, ASA r2, ASA, AFF, FAS, vSphere, VMware 
summary:  
---
= Die Implementierung von VVols auf AFF, ASA, ASA r2 und FAS Systemen
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Folgen Sie diesen Best Practices zur Erstellung von VVols Storage für Ihre Virtual Machines.

Die Bereitstellung von VVols Datastores umfasst mehrere Schritte. Die ASA r2-Systeme von NetApp wurden für VMware-Workloads entwickelt und bieten eine andere Benutzererfahrung als herkömmliche ONTAP-Systeme. Beim Einsatz von ASA r2 Systemen erfordern ONTAP Tools ab Version 10.3 weniger Schritte zur Einrichtung und beinhalten UI-Erweiterungen sowie für die neue Storage-Architektur optimierte REST-API-Unterstützung.



== Vorbereiten der Erstellung von VVols-Datenspeichern mit ONTAP Tools

Sie können die ersten beiden Schritte des Implementierungsprozesses überspringen, wenn Sie bereits ONTAP Tools zum Managen, Automatisieren und Berichten über Ihren vorhandenen VMFS- oder herkömmlichen NFS-basierten Storage nutzen. Darüber hinaus können Sie sich bei der Bereitstellung und Konfiguration von ONTAP-Tools mit diesem vollständigen link:vmware-vvols-checklist.html["Checkliste"]Bericht informieren.

. Erstellen Sie die Storage Virtual Machine (SVM) und deren Protokollkonfiguration. Beachten Sie, dass dies für ASA r2-Systeme möglicherweise nicht erforderlich ist, da diese in der Regel bereits über eine einzelne SVM für Datendienste verfügen. Sie wählen NVMe/FC (nur ONTAP Tools 9.13), NFSv3, NFSv4.1, iSCSI, FCP oder eine Kombination dieser Optionen. NVMe/TCP und NVMe/FC können auch für traditionelle VMFS-Datenspeicher mit ONTAP Tools ab Version 10.3 verwendet werden. Sie können entweder die ONTAP System Manager-Assistenten oder die Cluster-Shell-Befehlszeile verwenden.
+
** https://docs.netapp.com/us-en/ontap/disks-aggregates/assign-aggregates-svms-task.html["Zuweisung lokaler Tiers (Aggregate) zu SVMs"] Für alle nicht-ASA r2-Systeme.
** Mindestens eine LIF pro Node für jede Switch-/Fabric-Verbindung. Als Best Practice sollten Sie mindestens zwei pro Node für FCP-, iSCSI- oder NVMe-basierte Protokolle erstellen. Für NFS-basierte VVols ist eine LIF pro Node ausreichend, allerdings sollte diese LIF durch eine LACP-ifgroup geschützt werden. Weitere Informationen finden Sie unter https://docs.netapp.com/us-en/ontap/networking/configure_lifs_cluster_administrators_only_overview.html["Konfiguration der LIFs – Übersicht"] und https://docs.netapp.com/us-en/ontap/networking/combine_physical_ports_to_create_interface_groups.html["Kombinieren Sie physische Ports zum Erstellen von Schnittstellengruppen"].
** Mindestens eine Management-LIF pro SVM, wenn Sie SVM-bezogene Anmeldeinformationen für Ihre Mandanten-vCenters verwenden möchten.
** Wenn Sie planen, SnapMirror zu verwenden, stellen Sie Ihre Quelle und Ziel https://docs.netapp.com/us-en/ontap/peering/["ONTAP Cluster und SVMs sind auf Peering angewiesen"].
** Bei Systemen, die nicht dem ASA r2-Standard entsprechen, können Volumes zwar zu diesem Zeitpunkt erstellt werden, es empfiehlt sich jedoch, dies dem Assistenten „Provision Datastore“ in den ONTAP -Tools zu überlassen. Die einzige Ausnahme von dieser Regel besteht, wenn Sie die vVols Replikation mit VMware Site Recovery Manager und ONTAP Tools 9.13 verwenden möchten. Dies lässt sich einfacher mit bereits vorhandenen FlexVol Volumes und bestehenden SnapMirror Beziehungen einrichten. Achten Sie darauf, QoS nicht für Volumes zu aktivieren, die für vVols verwendet werden sollen, da dies von SPBM- und ONTAP Tools verwaltet werden soll.


. https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/deploy/ontap-tools-deployment.html["Implementieren Sie ONTAP-Tools für VMware vSphere"] Verwenden der von der NetApp Support-Website heruntergeladenen OVA.
+
** ONTAP tools 10.0 und höher unterstützen mehrere vCenter Server pro Appliance; Sie müssen nicht mehr für jeden vCenter Server eine ONTAP tools Appliance bereitstellen.
+
*** Wenn Sie mehrere vCenter-Server mit einer einzigen ONTAP -Tools-Instanz verbinden möchten, müssen Sie CA-signierte Zertifikate erstellen und installieren. Siehe https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/manage/certificate-manage.html["Verwalten von Zertifikaten"] für Schritte.


** Ab Version 10.3 werden die ONTAP -Tools nun als kleine Einzelknoten-Appliance bereitgestellt, die für die meisten Nicht-vVols-Workloads geeignet ist.




[TIP]
====
* Die empfohlene Vorgehensweise ist folgende: https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/manage/edit-appliance-settings.html["Tools für die horizontale Skalierung von ONTAP"] 10.3 und später auf die 3-Knoten-Hochverfügbarkeitskonfiguration (HA) für alle Produktionsworkloads umzustellen. Für Labor- oder Testzwecke ist eine Einzelknoten-Bereitstellung möglich.
* Die empfohlene Best Practice für den produktiven Einsatz von vVols besteht darin, jegliche Single Points of Failure zu eliminieren. Erstellen Sie Anti-Affinitätsregeln, um zu verhindern, dass die ONTAP -Tools-VMs gleichzeitig auf demselben Host ausgeführt werden. Nach der ersten Bereitstellung wird außerdem empfohlen, Storage vMotion zu verwenden, um die ONTAP -Tools-VMs in verschiedene Datenspeicher zu verschieben. Lesen Sie mehr über https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-resource-management-8-0/using-drs-clusters-to-manage-resources/using-affinity-rules-without-vsphere-drs.html["Verwendung von Affinitätsregeln ohne vSphere DRS"] oder https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/vsphere-resource-management-8-0/using-drs-clusters-to-manage-resources/create-a-vm-vm-affinity-rule.html["VM-VM-Affinitätsregel erstellen"]Die Sie sollten außerdem regelmäßige Datensicherungen einplanen und/oder https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/manage/backup-settings.html["Verwenden Sie das integrierte Konfigurationsdienstprogramm"]Die


====
. Konfigurieren Sie ONTAP Tools 10.3 für Ihre Umgebung.
+
** https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/add-vcenter.html["Fügen Sie vCenter Server-Instanzen hinzu"] In der ONTAP Tools Manager-UI.
** Die ONTAP Tools 10.3 unterstützen die sichere Mandantenfähigkeit. Wenn Sie keine sichere Mandantenfähigkeit benötigen, wechseln Sie einfach https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/add-storage-backend.html["Fügen Sie Ihre ONTAP-Cluster hinzu"] zum Menü „ONTAP Tools“ in vCenter und klicken auf „_Storage Backends_“ und anschließend auf die Schaltfläche „_add_“.
** In einer sicheren mandantenfähigen Umgebung, in der bestimmte Storage Virtual Machines (SVMs) an bestimmte vCenter delegiert werden sollen, müssen Sie Folgendes tun.
+
*** Melden Sie sich bei der UI für den ONTAP-Tools-Manager an
*** https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/add-storage-backend.html["Onboard des Storage-Clusters"]
*** https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/associate-storage-backend.html["Ordnen Sie ein Storage-Back-End einer vCenter Server-Instanz zu"]
*** Geben Sie dem vCenter-Administrator die spezifischen SVM-Zugangsdaten, der die SVM dann im Menü „ONTAP Tools Storage Backends“ in vCenter als Storage-Backend hinzufügt.






[TIP]
====
* In der Best Practice wird empfohlen, RBAC-Rollen für Ihre Storage-Konten zu erstellen.
* ONTAP tools beinhaltet eine JSON-Datei, die die für die ONTAP tools-Speicherkonten erforderlichen Rollenberechtigungen enthält. Sie können die JSON-Datei in den ONTAP System Manager hochladen, um die Erstellung von RBAC-Rollen und Benutzern zu vereinfachen.
* Weitere Informationen zu den Rollen für rollenbasierte Zugriffssteuerung von ONTAP finden Sie unter https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere-10/configure/configure-user-role-and-privileges.html#svm-aggregate-mapping-requirements["Konfigurieren Sie ONTAP-Benutzerrollen und -Berechtigungen"].


====

NOTE: Der Grund dafür, dass der gesamte Cluster in der ONTAP Tools Manager-Benutzeroberfläche eingebunden werden muss, liegt darin, dass viele der für vVols verwendeten APIs nur auf Clusterebene verfügbar sind.



== Erstellen von VVols Datastores mit ONTAP Tools

Klicken Sie mit der rechten Maustaste auf den Host, das Cluster oder das Datacenter, auf dem Sie den VVols-Datastore erstellen möchten, und wählen Sie dann _ONTAP Tools_ > _Provisioning Datastore_ aus.

image:vvols-deploy-1.png["Rolle=„Daumen“ „Assistent für Datastore-Bereitstellung„.300"]

* Wählen Sie VVols, einen aussagekräftigen Namen aus und wählen Sie das gewünschte Protokoll aus. Sie können auch eine Beschreibung des Datastore angeben.
+
** ONTAP Tools 10.3 mit ASA r2.




image:vvols-deploy-2.png["Rolle=„Daumen“ „Assistent für Datastore-Bereitstellung„.300"]

* Wählen Sie die SVM des ASA r2-Systems aus und klicken Sie auf _Next_.


image:vvols-deploy-3.png["Rolle=„Daumen“ „Assistent für Datastore-Bereitstellung„.300"]

* Klicken Sie auf „_Finish_“


image:vvols-deploy-4.png["Rolle=„Daumen“ „Assistent für Datastore-Bereitstellung„.300"]

* So einfach ist das!
+
** ONTAP Tools 10.3 mit ONTAP FAS, AFF und ASA vor ASA r2.


* Wählen Sie das Protokoll aus


image:vvols-deploy-5.png["Rolle=„Daumen“ „Assistent für Datastore-Bereitstellung„.300"]

* Wählen Sie die SVM aus und klicken Sie auf _Next_.


image:vvols-deploy-5a.png["Rolle=„Daumen“ „Assistent für Datastore-Bereitstellung„.300"]

* Klicken Sie auf _neue Volumes hinzufügen_ oder _vorhandenes Volume verwenden_ und geben Sie die Attribute an. Beachten Sie, dass Sie in ONTAP tools 10.3 die gleichzeitige Erstellung mehrerer Volumes anfordern können. Sie können auch manuell mehrere Volumes hinzufügen, um diese gleichmäßig über den ONTAP Cluster zu verteilen. Klicken Sie auf _weiter_


image:vvols-deploy-6.png["Rolle=„Daumen“ „Assistent für Datastore-Bereitstellung„.300"]

image:vvols-deploy-7.png["Rolle=„Daumen“ „Assistent für Datastore-Bereitstellung„.300"]

* Klicken Sie auf „_Finish_“


image:vvols-deploy-8.png["Rolle=„Daumen“ „Assistent für Datastore-Bereitstellung„.300"]

* Sie können die zugewiesenen Volumes im Menü „ONTAP-Tools“ der Registerkarte „Configure“ für den Datastore anzeigen.


image:vvols-deploy-9.png["Rolle=„Daumen“ „Assistent für Datastore-Bereitstellung„.300"]

* Sie können jetzt VM-Storage-Richtlinien über das Menü „_Policies and Profiles_“ in der vCenter UI erstellen.




== Migration von VMs von herkömmlichen Datastores auf VVols

Die Migration von VMs von herkömmlichen Datastores in einen VVols Datastore ist nicht komplizierter als das Verschieben von VMs zwischen herkömmlichen Datastores. Wählen Sie einfach die VM(s) aus, dann Migrate aus der Liste der Aktionen und dann einen Migrationstyp von _change Storage only_ aus. Wählen Sie bei der entsprechenden Aufforderung eine VM-Storage-Richtlinie aus, die Ihrem VVols-Datastore entspricht. Vorgänge für Migrationskopien können für SAN VMFS zu VVols Migrationen mit vSphere 6.0 und höher verlagert werden, jedoch nicht von NAS VMDKs zu VVols.



== Verwalten von VMs mithilfe von Richtlinien

Um die Speicherbereitstellung mit richtlinienbasierter Verwaltung zu automatisieren, müssen Sie VM-Speicherrichtlinien erstellen, die den gewünschten Speicherkapazitäten zugeordnet sind.


NOTE: ONTAP-Tools ab Version 10.0 verwenden keine Speicherfähigkeitsprofile mehr wie frühere Versionen. Stattdessen sind die Storage-Funktionen direkt in der Richtlinie für den VM-Storage selbst definiert.



=== Erstellen von VM-Storage-Richtlinien

VM-Speicherrichtlinien werden in vSphere verwendet, um optionale Funktionen wie Storage I/O Control oder vSphere Encryption zu verwalten. Sie werden auch zusammen mit vVols verwendet, um der VM bestimmte Speicherfunktionen zuzuweisen. Verwenden Sie den Speichertyp "NetApp.clustered.Data.ONTAP ONTAP". Unter link:vmware-vvols-ontap.html#Best Practices[example network configuration using vVols over NFS v3] finden Sie ein Beispiel hierfür mit dem ONTAP Tools VASA Provider. Regeln für den Speicher „NetApp.clustered.Data. ONTAP.VP.VASA10“ sind mit Datenspeichern zu verwenden, die nicht auf vVols basieren.

Sobald die Storage-Richtlinie erstellt wurde, kann sie bei der Bereitstellung neuer VMs verwendet werden.

image:vmware-vvols-deploy-vmsp-01.png["Rolle=„Daumen“ „Erstellung von VM-Speicherrichtlinien mit ONTAP Tools VASA Provider 9.10„.300"] image:vmware-vvols-deploy-vmsp-02.png["Rolle=„Daumen“ „Erstellung von VM-Speicherrichtlinien mit ONTAP Tools VASA Provider 9.10„.300"] image:vmware-vvols-deploy-vmsp-03.png["Rolle=„Daumen“ „Erstellung von VM-Speicherrichtlinien mit ONTAP Tools VASA Provider 9.10„.300"] image:vmware-vvols-deploy-vmsp-04.png["Rolle=„Daumen“ „Erstellung von VM-Speicherrichtlinien mit ONTAP Tools VASA Provider 9.10„.300"] image:vmware-vvols-deploy-vmsp-05.png["Rolle=„Daumen“ „Erstellung von VM-Speicherrichtlinien mit ONTAP Tools VASA Provider 9.10„.300"] image:vmware-vvols-deploy-vmsp-06.png["Rolle=„Daumen“ „Erstellung von VM-Speicherrichtlinien mit ONTAP Tools VASA Provider 9.10„.300"] image:vmware-vvols-deploy-vmsp-07.png["Rolle=„Daumen“ „Erstellung von VM-Speicherrichtlinien mit ONTAP Tools VASA Provider 9.10„.300"]



==== Performance-Management mit ONTAP Tools

ONTAP Tools verwenden einen eigenen Algorithmus für optimierte Platzierung, um ein neues vVol in den besten FlexVol volume zu platzieren – mit einheitlichen oder klassischen ASA Systemen oder einer Storage Availability Zone (SAZ) mit ASA r2 Systemen innerhalb eines VVols Datastore. Die Platzierung muss dem zugrunde liegende Storage mit der VM-Storage-Richtlinie übereinstimmen. Dadurch wird sichergestellt, dass der Datastore und der zugrunde liegende Storage die angegebenen Performance-Anforderungen erfüllen können.

Änderungen an den Leistungsfunktionen, wie z. B. Min und Max IOPS, erfordern eine genaue Konfiguration.

* *Min. Und Max. IOPS* können in einer VM Policy angegeben werden.
+
** Eine Änderung der IOPS in der Richtlinie ändert die QoS auf den vVols erst dann, wenn die VM-Richtlinie erneut auf die VMs angewendet wird, die sie verwenden. Alternativ können Sie eine neue Richtlinie mit den gewünschten IOPS erstellen und diese auf die Ziel-VMs anwenden. Im Allgemeinen empfiehlt es sich, für verschiedene Serviceebenen separate VM-Speicherrichtlinien zu definieren und die VM-Speicherrichtlinie einfach auf der VM zu ändern.
** Die Persönlichkeitstypen ASA, ASA r2, AFF und FAS haben unterschiedliche IOP-Einstellungen. Sowohl Min als auch Max sind auf allen Blitzsystemen verfügbar; allerdings können Nicht AFF -Systeme nur die Max-IOPS-Einstellungen verwenden.


* ONTAP-Tools erstellen individuelle QoS-Richtlinien ohne gemeinsame Nutzung mit derzeit unterstützten Versionen von ONTAP. Daher erhält jede einzelne VMDK eine eigene IOPS-Zuweisung.




===== Erneutes Anwenden der VM-Speicherrichtlinie

image:vvols-image16.png["Rolle=„Daumen“ „VM-Speicherrichtlinie neu anwenden“.300"]
