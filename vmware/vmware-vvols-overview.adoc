---
sidebar: sidebar 
permalink: vmware/vmware-vvols-overview.html 
keywords: tr-4400, vvols, ontap, virtual volumes 
summary: 'Dies ist eine Übersicht über VMware vSphere Virtual Volumes (VVols) mit ONTAP' 
---
= Überblick
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ONTAP ist seit über zwei Jahrzehnten eine der führenden Storage-Lösungen für VMware vSphere Umgebungen und wird kontinuierlich mit innovativen Funktionen erweitert, die nicht nur zur Vereinfachung des Managements, sondern auch zu Kostensenkungen beitragen.

Dieses Dokument behandelt die ONTAP Funktionen für VMware vSphere Virtual Volumes (VVols), einschließlich der neuesten Produktinformationen und Anwendungsfälle sowie Best Practices und andere Informationen, um die Implementierung zu optimieren und Fehler zu reduzieren.


NOTE: Diese Dokumentation ersetzt zuvor veröffentlichte technische Berichte _TR-4400: VMware vSphere Virtual Volumes (VVols) durch ONTAP_

Andere Dokumente wie Leitfäden und Kompatibilitätslisten werden durch Best Practices ergänzt. Sie werden basierend auf Labortests und umfassenden praktischen Erfahrungen der NetApp Ingenieure und Kunden entwickelt. Es handelt sich hierbei unter Umständen nicht nur um geeignete oder unterstützte Praktiken, sondern im Allgemeinen um die einfachsten Lösungen, die die Anforderungen der meisten Kunden erfüllen.


NOTE: Dieses Dokument wurde mit neuen VVols Funktionen aus vSphere 8.0 Update 3, der Version ONTAP Tools 10.4 und den neuen NetApp ASA Systemen aktualisiert.



== Virtual Volumes (VVols) – Übersicht

NetApp begann 2012 die Zusammenarbeit mit VMware zur Unterstützung von vSphere APIs for Storage Awareness (VASA) für vSphere 5. Dieser frühe VASA Provider ermöglichte die Definition von Storage-Funktionen in einem Profil, das zur Filterung von Datastores bei der Bereitstellung und zur Überprüfung der Einhaltung der Richtlinie anschließend verwendet werden konnte. Im Laufe der Zeit wurden neue Funktionen hinzugefügt, um eine stärkere Automatisierung der Bereitstellung zu ermöglichen. Zudem wurden Virtual Volumes oder VVols hinzugefügt, bei denen individuelle Storage-Objekte für Dateien von Virtual Machines und Virtual Disks verwendet werden. Es können sich bei diesen Objekten um LUNs, Dateien und jetzt um vSphere 8 – NVMe Namespaces (in Verbindung mit ONTAP Tools 9.13P2) handelt. NetApp hat 2015 eng mit VMware als Referenzpartner für VVols zusammengearbeitet, die im Bereich vSphere 6 und erneut als Designpartner für VVols unter Verwendung von NVMe over Fabrics in vSphere 8 veröffentlicht wurden. NetApp erweitert VVols kontinuierlich, um die Vorteile der neuesten Funktionen von ONTAP zu nutzen.

Es gibt mehrere Komponenten, die zu beachten sind:



=== VASA Provider

Dies ist die Softwarekomponente, die die Kommunikation zwischen VMware vSphere und dem Speichersystem übernimmt. Bei ONTAP wird VASA Provider in einer Appliance ausgeführt, bekannt als ONTAP Tools für VMware vSphere (kurz ONTAP Tools). Die ONTAP Tools enthalten außerdem ein vCenter Plug-in, einen Storage Replication Adapter (SRA) für VMware Site Recovery Manager und REST-API-Server zum Erstellen Ihrer eigenen Automatisierung. Sobald ONTAP Tools bei vCenter konfiguriert und registriert sind, besteht kaum noch Bedarf für eine direkte Interaktion mit dem ONTAP System, da sich Ihre Storage-Anforderungen nahezu vollständig über die vCenter UI oder ÜBER REST-API-Automatisierung managen lassen.



=== Protokollendpunkt (PE)

Der Protokollendpunkt ist ein Proxy für I/O zwischen den ESXi Hosts und dem VVols Datastore. ONTAP VASA Provider erstellt diese automatisch, entweder eine Protokollendpunkt-LUN (4 MB Größe) pro FlexVol Volume des VVols Datastores oder ein NFS-Bereitstellungspunkt pro NFS-Schnittstelle (LIF) auf dem Storage-Node, der ein FlexVol Volume im Datastore hostet. Der ESXi-Host mountet diese Protokollendpunkte direkt statt einzelner vVol-LUNs und Dateien mit virtuellen Laufwerken. Die Protokollendpunkte müssen nicht verwaltet werden, da sie vom VASA Provider zusammen mit den erforderlichen Schnittstellengruppen oder Exportrichtlinien automatisch erstellt, gemountet, unmountet und gelöscht werden.



=== Virtual Protocol Endpoint (VPE)

Neu in vSphere 8 ist bei Verwendung von NVMe over Fabrics (NVMe-of) mit VVols, das Konzept eines Protokollendpunkts in ONTAP nicht mehr relevant. Stattdessen wird ein virtueller PE automatisch vom ESXi-Host für jede ANA-Gruppe instanziiert, sobald die erste VM eingeschaltet ist. ONTAP erstellt automatisch ANA-Gruppen für jedes vom Datenspeicher verwendete FlexVol Volume.

Ein weiterer Vorteil bei der Nutzung von NVMe-of für VVols besteht darin, dass vom VASA Provider keine Bind-Anfragen erforderlich sind. Stattdessen verarbeitet der ESXi-Host die vVol-Bindungsfunktion intern basierend auf dem VPE. Dies verringert die Möglichkeit, dass ein vVol BIND-Ansturm den Service beeinträchtigt.

Weitere Informationen finden Sie unter https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-storage/GUID-23B47AAC-6A31-466C-84F9-8CF8F1CDD149.html["NVMe und Virtual Volumes"^] Ein https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-storage/GUID-23B47AAC-6A31-466C-84F9-8CF8F1CDD149.html["VMware.com"^]



=== Datastore für virtuelle Volumes

| Der Virtual Volume-Datenspeicher ist eine logische Datenspeicherdarstellung eines vVols Containers, die von einem VASA-Provider erstellt und verwaltet wird. Der Container repräsentiert einen Pool an Speicherkapazität, der von Speichersystemen bereitgestellt wird, die vom VASA-Anbieter verwaltet werden. ONTAP tools unterstützt die Zuordnung mehrerer FlexVol Volumes (die als Backing-Volumes bezeichnet werden) zu einem einzigen vVols Datenspeicher. Diese vVols Datenspeicher können sich über mehrere Knoten in einem ONTAP Cluster erstrecken und kombinieren Flash- und Hybridsysteme mit unterschiedlichen Fähigkeiten. Der Administrator kann neue FlexVol Volumes mithilfe des Bereitstellungsassistenten oder der REST-API erstellen oder, falls verfügbar, bereits erstellte FlexVol Volumes als Speichermedium auswählen.



=== Virtuelle Volumes (VVols)

vVols sind die eigentlichen virtuellen Maschinendateien und -datenträger, die im vVols Datenspeicher abgelegt sind. Der Begriff vVol (Singular) bezieht sich auf eine einzelne spezifische Datei, LUN oder einen Namensraum. ONTAP erstellt NVMe-Namespaces, LUNs oder Dateien, je nachdem, welches Protokoll der Datenspeicher verwendet. Es gibt verschiedene Arten von vVols; die gängigsten sind Konfigurationsvolumes (das einzige mit VMFS, es enthält Metadatendateien wie die VMX-Datei der VM), Datenvolumes (virtuelle Festplatte oder VMDK) und Auslagerungsvolumes (werden beim Einschalten der VM erstellt). Durch VMware-VM-Verschlüsselung geschützte vVols gehören zum Typ „Sonstige“. Die VMware VM-Verschlüsselung sollte nicht mit der ONTAP -Volume- oder Aggregatverschlüsselung verwechselt werden.



== Richtlinienbasiertes Management

VMware vSphere APIs for Storage Awareness (VASA) erleichtern es VM-Administratoren, die benötigten Speicherfunktionen zur Bereitstellung von VMs zu nutzen, ohne mit ihrem Speicherteam interagieren zu müssen. Vor VASA konnten VM-Administratoren zwar VM-Speicherrichtlinien definieren, mussten aber mit ihren Speicheradministratoren zusammenarbeiten, um geeignete Datenspeicher zu identifizieren, oft anhand von Dokumentationen oder Namenskonventionen. Mit VASA können vCenter-Administratoren mit den entsprechenden Berechtigungen eine Reihe von Speicherkapazitäten definieren, die vCenter-Benutzer dann zum Bereitstellen von VMs verwenden können. Die Zuordnung zwischen VM-Speicherrichtlinie und Datenspeicherfunktionen ermöglicht es vCenter, eine Liste kompatibler Datenspeicher zur Auswahl anzuzeigen und anderen Technologien wie VCF (früher bekannt als Aria und vRealize) Automation oder VMware vSphere Kubernetes Service (VKS) die automatische Auswahl von Speicher aus einer zugewiesenen Richtlinie zu ermöglichen. Dieser Ansatz wird als speicherrichtlinienbasierte Verwaltung bezeichnet. Obwohl VASA Provider-Regeln und VM-Speicherrichtlinien auch mit herkömmlichen Datenspeichern verwendet werden können, konzentrieren wir uns hier auf vVols -Datenspeicher.



=== VM-Storage-Richtlinien

VM Storage-Richtlinien werden in vCenter unter Richtlinien und Profile erstellt. Erstellen Sie für VVols mithilfe von Regeln des NetApp VVols Storage-Typ-Providers ein Regelwerk. ONTAP Tools 10.X bietet jetzt einen einfacheren Ansatz als ONTAP Tools 9.X, da Sie Storage-Attribute direkt in der VM Storage-Richtlinie selbst angeben können.

Wie bereits erwähnt, vereinfacht der Einsatz von Richtlinien die Bereitstellung von VMs oder VMDK. Wählen Sie einfach eine entsprechende Richtlinie aus. VASA Provider zeigt VVols Datastores, die diese Richtlinie unterstützen, und platziert das vVol in einer individuellen, konformen FlexVol volume.



=== Bereitstellung der VM mithilfe der Storage-Richtlinie

image::vvols-image3.png[Implementierung einer Virtual Machine mithilfe der Storage-Richtlinie,800,480]

Sobald eine VM bereitgestellt ist, überprüft der VASA-Anbieter weiterhin die Einhaltung der Richtlinien und benachrichtigt den VM-Administrator mit einem Alarm in vCenter, wenn das zugrunde liegende Volume nicht mehr den Richtlinien entspricht.



=== Einhaltung von VM-Storage-Richtlinien

image::vvols-image4.png[Einhaltung der Virtual Machine Storage-Richtlinien,320,100]



== NetApp VVols Unterstützung

ONTAP unterstützt die VASA-Spezifikation seit ihrer ersten Veröffentlichung im Jahr 2012. Obwohl auch andere NetApp Speichersysteme VASA unterstützen, konzentriert sich dieses Dokument auf die aktuell unterstützten Versionen von ONTAP 9.



=== ONTAP

Zusätzlich zu ONTAP 9 auf AFF, ASA und FAS -Systemen unterstützt NetApp VMware-Workloads auf ONTAP Select, Amazon FSx für NetApp mit VMware Cloud auf AWS, Azure NetApp Files mit Azure VMware Solution, Google Cloud NetApp Volumes mit Google Cloud VMware Engine und NetApp Private Storage in Equinix. Die spezifische Funktionalität kann jedoch je nach Dienstanbieter und verfügbarer Netzwerkkonnektivität variieren.

Zum Zeitpunkt der Veröffentlichung sind Hyperscaler-Umgebungen auf traditionelle NFS v3-Datenspeicher beschränkt; daher sind vVols nur mit On-Premises ONTAP Systemen oder Cloud-verbundenen Systemen verfügbar, die den vollen Funktionsumfang eines On-Premises-Systems bieten, wie beispielsweise Systeme, die von NetApp -Partnern und Serviceanbietern weltweit gehostet werden.

_Weitere Informationen zu ONTAP finden Sie unter https://docs.netapp.com/us-en/ontap-family/["ONTAP Produktdokumentation"^]_

_Weitere Informationen zu den Best Practices von ONTAP und VMware vSphere finden Sie unter link:vmware-vsphere-overview.html["TR-4597"^]_



== Vorteile der Verwendung von VVols mit ONTAP

Als VMware 2015 mit VASA 2.0 die vVols Unterstützung einführte, beschrieben sie diese als „ein Integrations- und Management-Framework, das ein neues Betriebsmodell für externe Speicher (SAN/NAS) liefert“. Dieses Betriebsmodell bietet in Verbindung mit ONTAP Speicherung mehrere Vorteile.



=== Richtlinienbasiertes Management

Wie in Abschnitt 1.2 erläutert, ermöglicht die richtlinienbasierte Verwaltung die Bereitstellung und anschließende Verwaltung von VMs mithilfe vordefinierter Richtlinien. Dies kann den IT-Betrieb in mehrfacher Hinsicht unterstützen:

* *Geschwindigkeit erhöhen.* Mit ONTAP tools entfällt für den vCenter-Administrator die Notwendigkeit, Tickets beim Speicherteam für Speicherbereitstellungsaktivitäten zu eröffnen. Allerdings ermöglichen die RBAC-Rollen der ONTAP Tools in vCenter und im ONTAP System weiterhin unabhängige Teams (z. B. Speicherteams) oder unabhängige Aktivitäten desselben Teams, indem der Zugriff auf bestimmte Funktionen bei Bedarf eingeschränkt wird.
* *Intelligentere Bereitstellung.* die Funktionen des Storage-Systems können über die VASA APIs zugänglich gemacht werden. So können Workflows für die Bereitstellung von erweiterten Funktionen profitieren, ohne dass der VM-Administrator ein Verständnis für das Management des Storage-Systems benötigt.
* *Schnellere Bereitstellung.* verschiedene Storage-Funktionen können in einem einzelnen Datastore unterstützt und anhand der VM-Richtlinie automatisch für eine VM ausgewählt werden.
* *Vermeiden von Fehlern.* Storage- und VM-Richtlinien werden vorab entwickelt und bei Bedarf angewendet, ohne dass bei jeder Bereitstellung einer VM Storage angepasst werden muss. Wenn sich die Storage-Funktionen von den festgelegten Richtlinien abdriften, werden Compliance-Alarme ausgelöst. Wie bereits erwähnt, ist die Erstbereitstellung durch SCPs vorhersehbar und wiederholbar, wobei die korrekte Platzierung durch die Verwendung von VM-Speicherrichtlinien auf den SCPs gewährleistet ist.
* *Besseres Kapazitätsmanagement.* VASA- und ONTAP-Tools ermöglichen bei Bedarf eine Anzeige der Storage-Kapazität bis auf die einzelne Aggregatebene und ermöglichen bei geringer Kapazität mehrere Alarmebenen.




=== Granulares VM-Management auf dem modernen SAN

SAN-Speichersysteme mit Fibre Channel und iSCSI waren die ersten, die von VMware für ESX unterstützt wurden, aber es fehlte ihnen die Möglichkeit, einzelne VM-Dateien und -Festplatten vom Speichersystem aus zu verwalten. Stattdessen werden LUNs bereitgestellt, und VMFS verwaltet die einzelnen Dateien. Dies erschwert es dem Speichersystem, die Speicherleistung, das Klonen und den Schutz einzelner VMs direkt zu verwalten. vVols bieten die Speichergranularität, die Kunden mit NFS-Speicher bereits nutzen, kombiniert mit den robusten und leistungsstarken SAN-Funktionen von ONTAP.

Mit vSphere 8 und den ONTAP tools for VMware vSphere 9.12 und höher stehen nun dieselben detaillierten Steuerungsmöglichkeiten, die von vVols für ältere SCSI-basierte Protokolle verwendet wurden, auch im modernen Fibre Channel SAN mit NVMe over Fabrics zur Verfügung, um eine noch höhere Leistung im großen Maßstab zu erzielen. Mit vSphere 8.0 Update 1 ist es nun möglich, eine vollständige End-to-End-NVMe-Lösung mit vVols ohne jegliche E/A-Übersetzung im Hypervisor-Speicherstack bereitzustellen.



=== Bessere Auslagerungsmöglichkeiten

Während VAAI eine Vielzahl von Operationen anbietet, die auf den Speicher ausgelagert werden, gibt es einige Lücken, die vom VASA Provider geschlossen werden. SAN VAAI ist nicht in der Lage, von VMware verwaltete Snapshots auf das Speichersystem auszulagern. NFS VAAI kann VM-verwaltete Snapshots auslagern, allerdings gibt es Einschränkungen für VMs mit speichernativen Snapshots. Da vVols einzelne LUNs, Namespaces oder Dateien für virtuelle Maschinenfestplatten verwenden, kann ONTAP die Dateien oder LUNs schnell und effizient klonen, um VM-granulare Snapshots zu erstellen, die keine Delta-Dateien mehr benötigen. NFS VAAI unterstützt auch keine Auslagerung von Klonvorgängen bei Hot-vMotion-Migrationen (bei eingeschaltetem System). Die VM muss ausgeschaltet werden, um die Migration bei Verwendung von VAAI mit herkömmlichen NFS-Datenspeichern auszulagern. Der VASA Provider in ONTAP Tools ermöglicht nahezu sofortige, speichereffiziente Klone für Hot- und Cold-Migrationen und unterstützt außerdem nahezu sofortige Kopien für Cross-Volume-Migrationen von vVols. Aufgrund dieser signifikanten Vorteile hinsichtlich der Speichereffizienz können Sie die Vorteile von vVols Workloads unter den folgenden Bedingungen voll ausschöpfen: https://www.netapp.com/pdf.html?item=/media/8207-flyer-efficiency-guaranteepdf.pdf["Effizienz-Garantie"] Programm. Sollten Cross-Volume-Klone mit VAAI Ihre Anforderungen nicht erfüllen, können Sie Ihre geschäftliche Herausforderung wahrscheinlich dank der Verbesserungen beim Kopiervorgang mit vVols lösen.



=== Häufige Anwendungsfälle für VVols

Neben diesen Vorteilen sehen wir auch folgende häufige Anwendungsfälle für vVol Storage:

* *Bedarfsgesteuerte Bereitstellung von VMs*
+
** Private Cloud oder Service-Provider-IaaS.
** Automatisierung und Orchestrierung über die Aria (ehemals vRealize) Suite, OpenStack usw.


* *First Class Disks (FCDs)*
+
** Persistente Volumes des VMware vSphere Kubernetes Service (VKS).
** Bereitstellung von Amazon EBS-ähnlichen Diensten durch unabhängiges VMDK-Lebenszyklusmanagement.


* *On-Demand Bereitstellung temporärer VMs*
+
** Labore für Test und Entwicklung
** Schulungsumgebungen






=== Gemeinsame Vorteile mit VVols

Wenn VVols so eingesetzt werden, wie in den oben genannten Anwendungsfällen, bieten sie folgende spezifische Verbesserungen:

* Klone können schnell innerhalb eines einzelnen Volumes oder über mehrere Volumes in einem ONTAP Cluster erstellt werden, was im Vergleich zu herkömmlichen VAAI-fähigen Klonen ein Vorteil ist. Sie sind außerdem speichereffizient. Klone innerhalb eines Volumes verwenden ONTAP -Dateiklone, die wie FlexClone -Volumes funktionieren und nur Änderungen gegenüber der Quell-vVol-Datei/LUN/Namensraum speichern. So lassen sich langfristige VMs für den Produktiveinsatz oder andere Anwendungszwecke schnell erstellen, benötigen nur minimalen Speicherplatz und profitieren von VM-Schutz (mittels NetApp SnapCenter Plugin für VMware vSphere, VMware-verwalteten Snapshots oder VADP-Backup) und Leistungsmanagement (mit ONTAP QoS). Volumeübergreifende Klone sind mit vVols wesentlich schneller als mit VAAI, da wir mit VASA den Klon erstellen und den Zugriff darauf am Zielort ermöglichen können, bevor der Kopiervorgang abgeschlossen ist. Die Datenblöcke werden als Hintergrundprozess kopiert, um das Ziel-vVol zu füllen. Dies ist vergleichbar mit der Funktionsweise des ONTAP -Verfahrens zur unterbrechungsfreien LUN-Verschiebung bei herkömmlichen LUNs.
* VVols stellen die ideale Storage-Technologie dar, wenn ein TKG mit vSphere CSI verwendet wird und separate Storage-Klassen und Kapazitäten bereitstellt, die vom vCenter Administrator gemanagt werden.
* Amazon EBS-ähnliche Dienste können über FCDs bereitgestellt werden, da eine FCD VMDK, wie der Name schon sagt, ein erstklassiges Element in vSphere ist und einen Lebenszyklus besitzt, der unabhängig von den VMs, an die sie angehängt sein könnte, verwaltet werden kann.

